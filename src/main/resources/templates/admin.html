<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Qu·∫£n l√Ω ng∆∞·ªùi d√πng</title>
    <link rel="stylesheet" th:href="@{/css/admin.css}">
    <script>
        function openAction(actionUrl) {
            window.open(actionUrl, "_blank");
        }
        
        document.addEventListener("DOMContentLoaded", () => {
        	  const token = localStorage.getItem("accessToken");
        	  if (!token) {
        	    // Ch∆∞a ƒëƒÉng nh·∫≠p ‚Üí chuy·ªÉn v·ªÅ trang login
        	    window.location.href = "/view/login";
        	    return;
        	  }

        	  // G·ªçi API ƒë·ªÉ x√°c minh quy·ªÅn
        	  fetch("/api/auth/check-role", {
        	    headers: { "Authorization": `Bearer ${token}` }
        	  })
        	  .then(res => {
        	    if (!res.ok) throw new Error();
        	    return res.json();
        	  })
        	  .then(data => {
        	    if (!data.roles.includes("ADMIN")) {
        	      window.location.href = "/view/home";
        	    }
        	  })
        	  .catch(() => {
        	    window.location.href = "/view/login";
        	  });
        	});
    </script>
</head>
<body>
    <h2>Danh s√°ch ng∆∞·ªùi d√πng</h2>
    <table border="1">
        <thead>
            <tr>
                <th>H·ªç</th>
                <th>T√™n</th>
                <th>Email</th>
                <th>Username</th>
                <th>Tr·∫°ng th√°i</th>
                <th>H√†nh ƒë·ªông</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="user : ${users}">
                <td th:text="${user.firstName}">H·ªç</td>
                <td th:text="${user.lastName}">T√™n</td>
                <td th:text="${user.email}">Email</td>
                <td th:text="${user.username}">Username</td>
                <td th:text="${user.status}">ACTIVE</td>
                <td>
                    <select onchange="if(this.value) openAction(this.value)">
                        <option value="">-- Ch·ªçn t√°c v·ª• --</option>
                        <option th:value="'/user/' + ${user.id}">üëÅÔ∏è Xem chi ti·∫øt</option>
                        <option th:value="'/user/confirm/' + ${user.id}">‚úîÔ∏è X√°c nh·∫≠n</option>
                        <option th:value="'/user/update/' + ${user.id}">‚úèÔ∏è C·∫≠p nh·∫≠t</option>
                        <option th:value="'/user/delete/' + ${user.id}">üóëÔ∏è Xo√°</option>
                    </select>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>